<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.quancheng.saluki.monitor.repository.SalukiInvokeMapper">

	<insert id="addInvoke" parameterType="java.util.List">
		insert into saluki_invoke (
				id,
				invokeDate,
				invokeTime,
				service,
				method,
				consumer,
				provider,
				type,
				success,
				failure,
				elapsed,
				concurrent,
				maxInput,
				maxOutput,
				maxElapsed,
				maxConcurrent,
				input,
				output,
				tps,
				kbps
		)
		values
		<foreach collection="list" item="data" separator="," index="index">
			(
			#{data.id},
			#{data.invokeDate},
			#{data.invokeTime},
			#{data.service},
			#{data.method},
			#{data.consumer},
			#{data.provider},
			#{data.type},
			#{data.success},
			#{data.failure},
			#{data.elapsed},
			#{data.concurrent},
			#{data.maxInput},
			#{data.maxOutput},
			#{data.maxElapsed},
			#{data.maxConcurrent},
			#{data.input},
			#{data.output},
			#{data.tps},
			#{data.kbps}
			)
		</foreach>
	</insert>

	<select id="queryData" parameterType="java.util.Map"
		resultType="com.quancheng.saluki.monitor.SalukiInvoke">
		SELECT *
		FROM saluki_invoke
		WHERE
		1 = 1
		<if test="service != null">
			AND service=#{service}
		</if>
		<if test="type != null">
			AND type=#{type}
		</if>
		<if test="type == 'consumer' and ip !=null">
			AND consumer=#{ip}
		</if>
		<if test="type == 'provider' and ip !=null">
			AND provider=#{ip}
		</if>
		ORDER BY invokeDate DESC
	</select>


</mapper>